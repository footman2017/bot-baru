intents:
    reenter:
        type: command
        condition: content == "reenter"
    
    intent_lihat_user:
        type: text
        initial: true
        classifier:
            nlu: nlu_dict
            expression: user_dict[0].resolved.dictKey=="user"

    intent_detail:
        type: text
        initial: true
        classifier:
            nlu: detailNLU
            match: detail

    intent_input_id_user:
        type: text
        initial: false
        fallback: false
        classifier:
            nlu: nlu_regex_id
        attributes:
            user_id:
                nlu: nlu_regex_id

    intent_cmd_get_user:
        type: command
        condition: content=="call_api_get_user"
    
    intent_cmd_get_user_byid:
        type: command
        condition: content=="call_api_get_user_by_id"

states:
    initial_state:
        initial: true
        transitions:
            state_get_email_user:
                condition: intent == 'intent_lihat_user'
            state_get_detail:
                condition: intent == 'intent_detail'

    state_get_email_user:
        action:
            - name: act_hit_api_get_users
            - name: command
              options:
                command: call_api_get_user
                payload:
                    res_api_get_user: $(result)
        transitions:
            state_show_users:
                mapping:
                    data.email: payload.res_api_get_user.email
            state_not_found:
                fallback: true

    state_show_users:
        action:
            - name: act_show_users
        end: true

    state_not_found:
        action:
            - name: act_not_found
        end: true

    state_get_detail:
        action:
            - name: act_ask_id
        end: false
        
        transitions:
            state_get_id:
                condition: intent=="intent_input_id_user"
                mapping:
                    data.user_id: attributes.user_id

            state_get_detail:
                fallback: true

    state_get_id:
        action:
            - name: act_hit_api_get_users_byid
            - name: command
              options:
                command: call_api_get_user_by_id
                payload:
                    res_api_get_user_byid: $(result)
        
        transitions:
            state_show_users_byid:
                mapping:
                    data.name: payload.res_api_get_user_byid.name
                    data.email: payload.res_api_get_user_byid.email
        end: false

    state_show_users_byid:
        action:
            - name: act_show_users_byid
        end: true

actions:
    act_hit_api_get_users:
        type: api
        options:
            method: GET
            uri: "$(config.urlApi)/users/1"

    act_show_users:
        type: text
        options:
            text:
                - Email user adalah $(data.email)

    act_not_found:
        type: text
        options:
            text:
                - Data Tidak ditemukan
    
    act_ask_id:
        type: text
        options:
            text:
                - Silahkan masukkan id user yang ingin dilihat (1-99)

    act_hit_api_get_users_byid:
        type: api
        options:
            method: GET
            uri: "$(config.urlApi)/users/$(data.user_id)"

    act_show_users_byid:
        type: text
        options:
            text:
                - "Nama: $(data.name)\nEmail: $(data.email)"